<h1 align="center">Bank — Финансовый TUI-менеджер на Go</h1>
<p align="center">
Учет счетов, категорий и операций. Импорт/экспорт (CSV/JSON), аналитика, логи, DI (Uber Dig), TUI (Bubble Tea).
</p>

<p align="center">
  <img alt="Go" src="https://img.shields.io/badge/Go-1.21%2B-00ADD8">
  <img alt="UI" src="https://img.shields.io/badge/TUI-bubbletea-6A4C93">
  <img alt="DI" src="https://img.shields.io/badge/DI-uber%2Fdig-1E90FF">
</p>

---

## Структура проекта

```text
task2/
├─ docs/                         # Хранит Readme   
├─ exampleFiles/                 # Файлы для импорта (примеры файлов)
├─ cmd/
│  └─ exportFiles/               # Сюда сохраняются файлы для экспорта
│  └─ main.go                    # Точка входа, DI-контейнер (uber/dig)
├─ domain/
│  ├─ entities/                  # Банковский счёт, Категория, Операция
│  ├─ factory/                   # Валидация/создание сущностей (BankAccount, Category, Operation)
│  ├─ ports/                     # Интерфейсы (DataImporter, ExporterVisitor)
│  ├─ repository/                # Интерфэйсы для репоиториев
│  └─ errordata/                 # ErrorRecord для записи ошибок
├─ internal/
│  ├─ app/                       # TUI-приложение (Bubble Tea) — состояния, экраны, навигация
│  ├─ bankmanager/               # Единая точка сохранения/поиска/удаления сущностей
│  ├─ balancemanager/            # Пересчет баланса (авто/вручную)
│  ├─ importer/                  # CSV/JSON импортеры + ImportFacade + лог декоратор
│  ├─ repository/                # Реализации интерфейсов репозиториев
│  ├─ export/                    # CSV/JSON экспорт + ExportFacade + визиторы + декоратор для логов + адаптеры
│  ├─ handmaker/                 # Ручной ввод c валидацией через фабрики
│  ├─ logstorage/                # Хранилище логов
│  └─ analitic/                  # аналитика + декоратор для логирования
├─ go.sum
└─ go.mod
```
# принципы **SOLID** и **GRASP** в проекте
---

## SOLID

### S — Single Responsibility (Единственная ответственность)
**Идея:** у каждого модуля одна чёткая причина для изменения.

**Где реализовано:**
- `internal/importer/`
  - `ImportCSV`, `ImportJSON` — только парсинг конкретного формата.
  - `ImportFacade` — только оркестрация импорта (вызовы парсера, фабрик, связывание ссылок).
  - `LoggingImportDecorator` — только логирование импорта.
- `internal/export/`
  - `ExportCSV`, `ExportJSON` — только выгрузка в конкретный формат.
  - `ExportFacade` — запускает экспорт.
  - `LoginExportDecorator` — логирование экспорта.
  - `BankAccountAdapter`, `CategoryAdapter`, `OperationAdapter` — адаптация коллекций к интерфейсу Visitor.
- `domain/factory/` — фабрики создают и валидируют доменные объекты.
- `internal/bankmanager/BankManager` — прикладные ручные-операции над сущностями.
- `internal/analitic/` — команды аналитики (расчёт баланса, группировка) и их лог-декоратор.
- `internal/logstorage/LogStorage` — хранение логов.

---

### O — Open/Closed (Открыт для расширения, закрыт для изменения)
**Идея:** добавляем новое поведение без правок существующего кода.

**Где реализовано:**
- `domain/ports.DataImporter` + реализации `ImportCSV`, `ImportJSON`  
  → новый формат импорта = новая реализация интерфейса.
- `domain/ports/exporterVisitor` + `internal/export/exportJSON`, `internal/export/exportCVS`
  → новый формат экспорта = новый Visitor.
- `internal/analitic/command`  
  → новая аналитическая операция = новая команда.

---

### L — Liskov Substitution (Подстановка Лисков)
**Идея:** любая реализация интерфейса взаимозаменяема.

**Где реализовано:**  
Во всех местах, где принимаются абстракции (`DataImporter`, `ExporterVisitor`, `Command`): `ImportFacade`, `ExportFacade`, декораторы логирования, сборка зависимостей в `cmd/main.go` (через DI).

---

### I — Interface Segregation (Разделение интерфейсов)
**Идея:** лучше несколько маленьких интерфейсов, чем один «толстый».

**Где реализовано:**
- `domain/ports/`:
  - `DataImporter` (минимальный контракт: `SetFilePath`, `ParseData`, `ParseBankAccounts|Categories|Operations`, `GetErrorData`).
  - `ExporterVisitor` (три узкоспециализированных метода экспорта).
  - `repository.*` (раздельные интерфейсы для аккаунтов, категорий, операций).
- `internal/analitic/Command` — общий крошечный интерфейс `Execute()`.

---

### D — Dependency Inversion (Инверсия зависимостей)
**Идея:** верхние уровни зависят от абстракций, а не от конкретных реализаций.

**Где реализовано:**
- `cmd/main.go` (DI: `uber/dig`) — в граф поставляются **интерфейсы/фасады**, конкретные реализации подменяемы.
- `ImportFacade` зависит от **`DataImporter`**, а не от `ImportCSV/ImportJSON`.
- `ExportFacade` зависит от **`ExporterVisitor`**, а не от `ExportCSV/ExportJSON`.
- Аналитика зависит от интерфейса `Command`.

---

## GRASP


### Low Coupling (Низкая связанность) / High Cohesion (Высокая связность)
**Идея:** модули мало знают друг о друге и концентрируются на своей роли.
- Парсеры изолированы от фасадов, фасады изолированы от UI.
- Экспортёры изолированы от источника данных: получают адаптеры через интерфейс.
- Репозитории скрывают детали хранения от `BankManager`.

---

## Дополнительно

### DI-контейнер (Uber Dig)
- `cmd/main.go` — сборка зависимостей через `dig.New()` и `Provide(...)`.
- Позволяет подменять реализации (например, `ImportCSV` → `ImportJSON`) без изменения внешнего кода.



## Пункты меню 

> Навигация: `↑/↓` — перемещение, `Enter` — выбрать, `Esc` — назад/выйти.

### Главное меню
- **Импорт** → подменю импорта.
- **Экспорт** → подменю экспорта.
- **Пересчёт баланса** → авто/ручной пересчёт.
- **Аналитика** → отчёты по периодам и категориям.
- **Ручной ввод** → счёты/категории/операции.
- **Просмотр логов** → последние операции и их длительность.
- **Выход** → завершение приложения.

---

### Импорт
Поддерживаются **CSV** и **JSON**. Все ошибки строк собираются и доступны для просмотра.

- **Импорт CSV**  
  Введите путь к файлу (например, `./examplesFile/sample.csv`).  
  Файл валидируется: расширение, доступ, не пустой, корректные разделители.
- **Импорт JSON**  
  Аналогично CSV (например, `./examplesFile/sample.json`).
- **Просмотр ошибок при импорте**  
  Показывает все некритичные ошибки строк (битая дата, неверный ID и т.п.).
- **Назад**

> После успешного импорта: данные прогоняются через фабрики, операции
> линкуются на уже импортированные **счета** и **категории** по ID.

---

### Экспорт
Экспортирует текущие **счета**, **категории** и **операции** в директорию `./exportFiles`.

- **Экспорт CSV**  
  Введите базовое имя (например, `report`). Будут сгенерированы:  
  `report_BackAccounts.csv`, `report_Category.csv`, `report_Operation.csv`.
- **Экспорт JSON**  
  Аналогично CSV:  
  `report_BackAccounts.json`, `report_Category.json`, `report_Operation.json`.
- **Назад**

> Если директории нет — будет создана. Имя файла нормализуется, расширение добавляется автоматически.

---

### Пересчёт баланса
- **Автоматически**  
  Пересчитать баланс каждого счёта на основе всех операций, привязанных к этому счёту.
- **Вручную**  
  Введите **ID счёта**, затем — новое значение баланса (например, `1234.56`).  
  Баланс устанавливается в указанное значение.
- **Назад**

---

### Аналитика
- **Подсчёт разницы доходов и расходов за период**  
  Введите `Дата начала (YYYY-MM-DD)` и `Дата конца (YYYY-MM-DD)`.  
  Покажет: `Итого доход`, `Итого расход`, `Разница`, период.
- **Группировка по категориям**  
  Сводка по суммам в разрезе категорий (доход/расход), на основе текущих операций и категорий.
- **Назад**

> Команды аналитики логируются: время старта, длительность, ошибки (если были).

---

### Ручной ввод (CRUD)
Два шага: выбрать **сущность**, затем — **действие**.

1) **Сущность**:
   - **Счета**
   - **Категории**
   - **Операции**
   - **Назад**

2) **Действие**:
   - **Создать** — заполняются поля по очереди (ID, имя/тип, суммы, даты и т.д.).
   - **Редактировать** — те же поля, запись выбирается по `ID`.
   - **Удалить** — ввод `ID` для удаления.
   - **Назад**

> Контроллер ручного ввода валидирует данные (через фабрики) и сохраняет через `BankManager`.
> Ошибки (например, дубликат `ID`) показываются на экране и попадают в общий лог.

---

### Просмотр логов
Показывает последние операции приложения:
- тип команды (импорт/экспорт/аналитика),
- время старта (RFC3339),
- длительность выполнения,
- текст ошибки (если был).

Нажмите `Enter` или `Esc`, чтобы вернуться в главное меню.

---

## Реализованные паттерны в проекте

Ниже — краткий список паттернов с указанием, где именно они применены и зачем.

---

### 1) **Factory** (Фабрика)
- **Где:** `domain/factory/*`  
- **Зачем:** Централизует создание доменных сущностей с валидацией (пустые ID/имя, тип категории ∈ {доход, расход}, `amount > 0`, валидная дата и т. п.).

---

### 2) **Facade** (Фасад)
- **Где:**  
  - `internal/importer/ImportFacade` — единая точка чтения из `DataImporter`, валидации через фабрики.  
  - `internal/export/ExportFacade` — единая точка экспорта всех сущностей (операции, категории, счета) в формате CSV/JSON.  
  - `internal/analitic/AnalyticsFacade` — обёртка над аналитическими операциями (расчёт баланса за период, группировки).
- **Зачем:** Прячет сложность связок (импорт/валидация/связывание/экспорт/аналитика) и предоставляет простой доступ.

---

### 3) **Strategy** (Стратегия)
- **Где:** `domain/ports.DataImporter` + реализации `internal/importer/{csv,json}`  
- **Зачем:** Внешний код (фасад импорта) не знает, из какого источника читать — подставляется нужная стратегия чтения (CSV/JSON).

---

### 4) **Visitor** (Посетитель)
- **Где:**  
  - Интерфейс: `internal/export/ExporterVisitor`  
  - Конкретные визиторы: `ExportCSV`, `ExportJSON`  
  - Элементы: адаптеры `CategoryAdapter`, `BankAccountAdapter`, `OperationAdapter` реализуют `Visitable.Accept(...)`
- **Зачем:** Легко добавлять новые форматы экспорта.

---

### 5) **Adapter** (Адаптер)
- **Где:** `internal/export/adaptersEntities.go`  
  - `CategoryAdapter`, `BankAccountAdapter`, `OperationAdapter`
- **Зачем:** у нас есть разные типы данных — счета, категории, операции. Экспортёры (CSV/JSON) ожидают единый интерфейс с методами `ExportBankAccount`, `ExportCategory`, `ExportOperation`.  
- **Проблема:** данные живут каждый в своём слайсе, а экспортёр хочет, чтобы их к нему подвели одинаковым способом.  
- **Решение (Adapter):** оборачиваем слайс в небольшой объект-адаптер с методом `Accept(exporter)`. Внутри он просто вызывает нужный метод экспортёра и передаёт ему свои данные.

---

### 6) **Decorator** (Декоратор)
- **Где:**  
  - Импорт: `LoggingImportDecorator` — логирует запуск/длительность/ошибки импорта.  
  - Экспорт: `LoginExportDecorator` — логирует запуск/длительность/ошибки экспорта по каждому адаптеру.  
  - Аналитика: `LoggingDecoratorForAnalitic` — логирует выполнение команд аналитики.
  - Аналитика: `InputPeriodDecorator` — добавляет даты для команды `CalculateBalanceCommand` так как она выводит данные за какой-то период
- **Зачем:** Добавляет к операциям сквозную функциональность (логирование) без изменения основной логики.

---

### 7) **Command** (Команда)
- **Где:** `internal/analitic` (интерфейс `Command` +  инициатор команд `Invoker`)
- **Зачем:** Операции аналитики оформлены как исполняемые команды; это упрощает логирование и позволдит в будущем добавлять еще команды.

---
### 8) **Шаблонный метод** 
- **Где:** `internal/importer/shablonFunc.go`
- Централизует **последовательность шагов** импорта.
- Позволяет **легко добавлять новые форматы** (XML, XLSX и т.п.): достаточно
  реализовать `ports.DataImporter`, а сценарий не меняется.



## Импорт:

**Поддерживаемые источники:** CSV и JSON через интерфейс `ports.DataImporter`  
**Фасад:** `ImportFacade`

- **Валидация через фабрики** (`domain/factory`):
  - `BankAccountFactory.CreateBankAccount` — проверяет `id`, `name`, `balance ≥ 0`.
  - `CategoryFactory.CreateCategory` — проверяет `id`, `name`, `type ∈ {доход, расход}`.
  - `OperationFactory.CreateOperation` — проверяет `id`, `type ∈ {доход, расход}`, `amount > 0`, `date`, ссылки.
- **Дубликаты ID**: сам импорт не сохраняет — дубликаты отсекаются на слое сохранения (`BankManager`).
- **Логи импорта**: фиксируются **время старта (RFC3339)**, **длительность (мс/с)**, источник (`CSV`/`JSON`).

**Формат CSV (ожидаемые колонки):**
- `bank_account`: `type=bank_account`, `id`→[1], `name`→[8], `balance`→[9]
- `category`: `type=category`, `id`→[1], `type(доход/расход)`→[2], `name`→[8]
- `operation`: `type=operation`, `id`→[1], `opType`→[2], `account_id`→[3], `amount`→[4], `date(YYYY-MM-DD)`→[5], `description`→[6], `category_id`→[7]

**Формат JSON:**
```json
{
  "bank_accounts": [{"id":"...","name":"...","balance":0}],
  "categories":    [{"id":"...","type":"доход|расход","name":"..."}],
  "operations":    [{"id":"...","type":"доход|расход","account_id":"...","amount":0,"date":"YYYY-MM-DD","description":"...","category_id":"..."}]
}
```
## Экспорт

Экспорт реализован через паттерн **Visitor**: конкретные экспортёры (`ExportCSV`, `ExportJSON`) посещают адаптеры данных (`BankAccountAdapter`, `CategoryAdapter`, `OperationAdapter`) и сохраняют их в файлы. Управляет всем **`ExportFacade`**, логирование выполняет `LoginExportDecorator`.

### Как работает
1. В TUI выбери: **Экспорт → CSV** или **Экспорт → JSON**.  
2. Введи базовое имя файла (например, `report`).  
3. Файлы будут сохранены в директории `./exportFiles` с суффиксами по типам данных.

### Интерфейсы и классы
- **ExporterVisitor** — интерфейс экспортёра:
  - `SetFilePath(path string) error`
  - `ExportBankAccount(accounts []*entities.BankAccount) error`
  - `ExportCategory(categories []*entities.Category) error`
  - `ExportOperation(operations []*entities.Operation) error`
- **Реализации**: `ExportCSV`, `ExportJSON`
- **Адаптеры (Visitable)**:
  - `BankAccountAdapter` — экспорт счетов
  - `CategoryAdapter` — экспорт категорий
  - `OperationAdapter` — экспорт операций
- **Фасад**: `ExportFacade` — конфигурирует адаптеры и запускает экспорт
- **Логи**: `LoginExportDecorator` — пишет в лог тип экспортёра, сущность, время старта и длительность

### Папка назначения
Все файлы экспортируются в директорию: exportFiles
Если её нет — будет создана автоматически. `SetFilePath("report")` нормализует имя и добавляет нужное расширение.

---

### Форматы файлов

#### CSV
Генерируются три файла:

- `report_BackAccounts.csv` — **счета**
  - Заголовки: `ID,Name,Balance`
- `report_Category.csv` — **категории**
  - Заголовки: `ID,Type,Name`
- `report_Operation.csv` — **операции**
  - Заголовки: `ID,Type,AccountID,Amount,Date,Description,CategoryID`

Пример `report_Operation.csv`:
```csv
ID,Type,AccountID,Amount,Date,Description,CategoryID
1,расход,1,1500.00,2024-01-15,Обед,2
2,доход,1,50000.00,2024-01-10,Зарплата,1
```
### JSON

Генерируются три файла:

- `report_BackAccounts.json`
- `report_Category.json`
- `report_Operation.json`

**Фрагмент `report_Operation.json`:**
```json
[
  {
    "id": "1",
    "type": "расход",
    "account": { "id": "1", "name": "Основной счёт", "balance": 0 },
    "amount": 1500,
    "date": "2024-01-15",
    "description": "Обед",
    "category": { "id": "2", "type": "расход", "name": "Еда" }
  }
]
```
## BankManager (кратко)

`BankManager` — простой слой над репозиториями.  
Через него приложение **добавляет / находит / удаляет / перечисляет** счета, категории и операции.


---

### Что делает

- Хранит ссылки на три репозитория:
  - `RepositoryBankAccounts`
  - `RepositoryCategory`
  - `RepositoryOperations`
- Массово добавляет данные.


---
